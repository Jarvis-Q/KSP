{"note":"Don't delete this file! It's used internally to help with page regeneration.","tagline":"KISSY Simple Pie","body":"KSP\r\n=======\r\n\r\nKissy Simple Pie\r\n\r\n又一个KISSY模块打包工具，特点：\r\n * 使用JSON文件进行灵活的包配置.\r\n * 完全灵活，没有文件目录的要求.\r\n * 功能单一：只提供打包功能(有空了把压缩也加上)\r\n * 基于`moduleCompiler`,非常感谢@紫英\r\n\r\n## 安装\r\n\r\n```\r\nnpm install ksp -g\r\n```\r\n\r\n## 使用\r\n\r\n### 基本\r\n\r\n`ksp`的使用是基于配置文件`ksp.json`，且理论上配置文件与需要打包的文件没有强制的路径位置关系。\r\n\r\nOK!直接看下例子，现在我们有目录`KSP/example/package_one`,该目录下文件如下：\r\n\r\n`main_a.js`:\r\n\r\n```js\r\nKISSY.add(function(){\r\n\r\n    console.log( 'index');\r\n},{requires: [ './mod' ]});\r\n```\r\n\r\n`mod.js`:\r\n\r\n```js\r\nKISSY.add(function(){\r\n    console.log( 'mod' );\r\n});\r\n```\r\n\r\n要将两个模块打包，我们需要在`KSP/example/package_one`目录下添加配置文件`ksp.json`, 内容如下:\r\n\r\n```js\r\n{\r\n    \"name\": \"example\",\r\n    \"charset\": \"gbk\",\r\n    \"pub\": 20120820,\r\n    \"main\": \"main_a.js\",\r\n    \"output\": \"publish/main_a.combo.js\"\r\n}\r\n```\r\n\r\n好的，你需要的配置工作到此为止.接下来你只需要在终端(win下cmd)下进入目录`KSP/example/package_one`，然后执行：\r\n\r\n```\r\nksp\r\n```\r\n\r\nOK!打包完毕,打包后的文件会输出到路径`KSP/example/package_one/publish/20120820/main_a.combo.js`。\r\n\r\n打包过的文件的模块名称为`example/package_one/mod`和`example/package_one/main_a`。\r\n\r\n注意到`ksp`自动为`output`添加了`put`值作为时间戳目录，如果没有给出`put`则直接使用`output`.\r\n\r\n### Path? KSP自动帮你找到它\r\n\r\n注意到，在`ksp.json`中，只给定了包名，`KSP`自动根据当前路径向上找到包名对应的路径，不需要手动配置。\r\n\r\n### 批量打包多个文件\r\n\r\n如果有多个文件需要打包，只需要在`ksp.json`中将所有的入口文件以数组的形式设置给`main`：\r\n\r\n```js\r\n{\r\n    \"name\": \"example\",\r\n    \"charset\": \"gbk\",\r\n    \"pub\": 20120820,\r\n    \"main\": [\"package_one/main_a.js\", \"package_two/main_b.js\"],\r\n    \"output\": \"publish/{{filename}}.combo.js\"\r\n}\r\n```\r\n\r\n其中`output`值使用`mustache`作为模板构造文件输出路径，除了`filename`外，还有以下几个变量可以使用:\r\n\r\n * pub 如果给出了pub\r\n * path 入口文件所在路径\r\n * basePath 入口文件的父目录名称，比如入口文件`package_one/main_a.js`，其`basePath`为`package_one`\r\n\r\n通过以上参数，我们可以构建很灵活的输出路径，比如下面的配置(将该配置文件放在目录`KSP/example`目录下)：\r\n\r\n```js\r\n{\r\n    \"name\": \"example\",\r\n    \"charset\": \"gbk\",\r\n    \"pub\": 20120820,\r\n    \"main\": [\"package_one/main_a.js\", \"package_two/main_b.js\"],\r\n    \"output\": \"publish/{{pub}}/{{basePath}}/{{filename}}.combo.js\"\r\n}\r\n```\r\n\r\n将输出目录:\r\n\r\n```\r\nKSP\r\n - example\r\n    - publish\r\n       - 20120820\r\n          - package_one\r\n             - main_a.combo.js\r\n          - package_two\r\n             - main_a.combo.js\r\n```\r\n\r\n### (小众功能）将KISSY 配置和入口执行以及模块定义合并，All in one.\r\n\r\n要使用该小众功能，只需要在执行`ksp`命令式添加使用参数`-w`：`ksp -w`，将会输出如下文件:\r\n\r\n```js\r\n(function(S){\r\n\r\n    // 包名\r\n    var PACKAGE_NAME = 'example';\r\n    // 入口模块的包路径\r\n    var MAIN_MOD_PATH = 'example/package_one/main_a.js';\r\n    // 包Tag\r\n    var PACKAGE_TAG = '';\r\n    // 包的编码\r\n    var PACKAGE_CHARSET = 'gbk';\r\n\r\n    // 获取KISSY package 配置需要用到的 `path` 值.\r\n    var scripts = document.getElementsByTagName(\"script\");\r\n    var currentScriptPath = scripts[ scripts.length -1 ].src;\r\n    var packagePath;\r\n\r\n    // 若为IE，则会取相对地址...因此根据当前页面构造\r\n    if( S.UA.ie <= 7 && currentScriptPath.indexOf( 'http://' ) < 0 ){\r\n        var pageUrl = location.href;\r\n        var pageUrlArr = pageUrl.split( '/');\r\n        var packagePathArr = currentScriptPath.split( '/' );\r\n        pageUrlArr.pop();\r\n\r\n        S.each( packagePathArr, function( pkgSeg ){\r\n            if( pkgSeg == '..' ){\r\n                pageUrlArr.pop();\r\n            }\r\n            else if( pkgSeg != '.' ){\r\n                pageUrlArr.push( pkgSeg );\r\n            }\r\n        });\r\n\r\n        currentScriptPath = pageUrlArr.join( '/' );\r\n    }\r\n\r\n    // 当前脚本的url除去入口模块的路劲就是包的path.\r\n    packagePath = currentScriptPath.substring( 0, currentScriptPath.indexOf( MAIN_MOD_PATH ) );\r\n\r\n    // 包配置\r\n    S.config({\r\n        packages:[\r\n            {\r\n                name: PACKAGE_NAME,\r\n                tag: PACKAGE_TAG,\r\n                path: packagePath,\r\n                charset: PACKAGE_CHARSET\r\n            }\r\n        ]\r\n    });\r\n})( KISSY );\r\n\r\n// 引入所有的模块定义\r\n/*\r\ncombined files :\r\n\r\nexample/package_one/mod\r\nexample/package_one/main_a\r\n\r\n*/\r\nKISSY.add('example/package_one/mod',function(){\r\n    console.log( 'mod' );\r\n});KISSY.add('example/package_one/main_a',function(){\r\n\r\n    console.log( 'index');\r\n},{requires: [ './mod' ]});\r\n\r\n(function(S){\r\n    // 启动入口模块\r\n    S.use( 'example/package_one/main_a.js' );\r\n})();\r\n\r\n```\r\n\r\nThat's all!\r\n\r\n## License\r\n\r\n(The MIT License)\r\n\r\nCopyright (c) 2012 Neekey ni184775761@gmail.com;\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the 'Software'), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.","name":"Ksp","google":""}